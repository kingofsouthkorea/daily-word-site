<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>ì˜¤ëŠ˜ì˜ ë­í‚¹</title>

<style>
body {
  font-family: Arial, sans-serif;
  background: #111;
  color: white;
  text-align: center;
  padding: 40px;
}

h1 {
  margin-bottom: 10px;
}

input {
  padding: 10px;
  font-size: 16px;
  width: 200px;
}

button {
  padding: 10px 20px;
  font-size: 16px;
  cursor: pointer;
}

ul {
  list-style: none;
  padding: 0;
}

li {
  margin: 8px 0;
  font-size: 18px;
}
</style>
</head>

<body>

<h1 id="title">ì˜¤ëŠ˜ì˜ 1ìœ„ ë‹¨ì–´</h1>
<input id="wordInput" placeholder="ë‹¨ì–´ ì…ë ¥">
<button onclick="submitWord()">ì œì¶œ</button>

<h2>ë­í‚¹</h2>
<ul id="rankingList"></ul>

<!-- Firebase -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import {
  getFirestore,
  collection,
  doc,
  getDoc,
  setDoc,
  updateDoc,
  increment,
  onSnapshot,
  query,
  orderBy,
  limit,
  serverTimestamp
} from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

/* ğŸ”¥ ì—¬ê¸°ì— ë³¸ì¸ Firebase ì„¤ì • ë¶™ì—¬ë„£ê¸° */
const firebaseConfig = {
  apiKey: "AIzaSyD3NibqQIrgnmlez1s0WhUZ-H4b8YpnPSY",
  authDomain: "daily-word-site-6402f.firebaseapp.com",
  projectId: "daily-word-site-6402f",
  storageBucket: "daily-word-site-6402f.firebasestorage.app",
  messagingSenderId: "144399874318",
  appId: "1:144399874318:web:0e278d40b251952dc67f5f"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

let lastSubmitTime = 0;

/* 3ì´ˆ ì œí•œ */
window.submitWord = async () => {
  const now = Date.now();
  if (now - lastSubmitTime < 1000) {
    alert("1ì´ˆì— í•œ ë²ˆë§Œ ì…ë ¥ ê°€ëŠ¥í•©ë‹ˆë‹¤.");
    return;
  }

  const word = document.getElementById("wordInput").value.trim();
  if (!word) return;

  lastSubmitTime = now;
  document.getElementById("wordInput").value = "";

  const ref = doc(db, "rankings", word);
  const snap = await getDoc(ref);

  if (snap.exists()) {
    await updateDoc(ref, {
      count: increment(1),
      updatedAt: serverTimestamp()
    });
  } else {
    await setDoc(ref, {
      word,
      count: 1,
      updatedAt: serverTimestamp()
    });
  }
};

/* ğŸ”¥ ì‹¤ì‹œê°„ ë­í‚¹ */
const q = query(
  collection(db, "rankings"),
  orderBy("count", "desc"),
  limit(10)
);

onSnapshot(q, (snapshot) => {
  const list = document.getElementById("rankingList");
  list.innerHTML = "";

  let rank = 1;
  snapshot.forEach(doc => {
    const data = doc.data();
    const li = document.createElement("li");
    li.textContent = `${rank}. ${data.word} (${data.count})`;
    list.appendChild(li);

    if (rank === 1) {
      document.getElementById("title").textContent =
        `ğŸ”¥ 1ìœ„: ${data.word}`;
    }
    rank++;
  });
});
</script>

</body>
</html>
